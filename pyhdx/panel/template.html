{% extends base %}
<!-- goes in body -->
{% block contents %}
{% set context = 'server' %}
{% if context == 'notebook' %}
    {% set slicer_id = get_id() %}
    <div id='{{slicer_id}}'></div>
{% endif %}

<script>
var config = {
    settings: {
        hasHeaders: true,
        constrainDragToContainer: true,
        reorderEnabled: true,
        selectionEnabled: false,
        popoutWholeStack: false,
        blockedPopoutsThrowError: true,
        closePopoutsOnUnload: true,
        showPopoutIcon: false,
        showMaximiseIcon: true,
        showCloseIcon: false
    },
    content: [{
        type: 'row',
        content:[
            {
                type: 'stack',
                content: [
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.input) }}',
                            title: 'Input',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.coverage) }}',
                            title: 'Coverage',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.fitting) }}',
                            title: 'Fit Rates',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.tf_fit) }}',
                            title: 'Fit PF',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.fit_quality) }}',
                            title: 'Fit Quality',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.classification) }}',
                            title: 'Classification',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.file_export) }}',
                            title: 'Export',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.options) }}',
                            title: 'Options',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    },
                    {
                        type: 'component',
                        componentName: 'view',
                        componentState: {
                            model: '{{ embed(roots.dev) }}',
                            title: 'Dev',
                            width: 350,
                            css_classes: ['scrollable']
                        },
                        isClosable: false,
                    }
                        ]
            },
            {
                type: 'column',
                content: [
                    {
                        type: 'stack',
                        content:[
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: {
                                    model: '{{ embed(roots.coverage_fig) }}',
                                    title: 'Coverage'
                                },
                                isClosable: false,
                            },

                        ]
                    },
                    {
                        type: 'stack',
                        content:[
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: {
                                    model: '{{ embed(roots.rate_fig) }}',
                                    title: 'Uptake rates',
                                    height: 200
                                },
                                isClosable: false,
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: {
                                    model: '{{ embed(roots.pfact_fig) }}',
                                    title: 'Protection Factors',
                                    height: 200
                                },
                                isClosable: false,
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: {
                                    model: '{{ embed(roots.fitres_fig) }}',
                                    title: 'Fit Result',
                                    height: 200
                                },
                                isClosable: false,
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: {
                                    model: '{{ embed(roots.slice_k) }}',
                                    title: 'Slice K',
                                    height: 200
                                },
                                isClosable: false,
                            }
                        ]
                    }
                ]
            }
        ]
    }]
};

{% if context == 'notebook' %}
    var myLayout = new GoldenLayout( config, '#' + '{{slicer_id}}' );
    $('#' + '{{slicer_id}}').css({width: '100%', height: '800px', margin: '0px'})
{% else %}
    var myLayout = new GoldenLayout( config );
{% endif %}

myLayout.registerComponent('view', function( container, componentState ){
    const {width, css_classes} = componentState
    if(width)
      container.on('open', () => container.setSize(width, container.height))
    if (css_classes)
      css_classes.map((item) => container.getElement().addClass(item))
    container.setTitle(componentState.title)
    container.getElement().html(componentState.model);
    container.on('resize', () => window.dispatchEvent(new Event('resize')))
});

myLayout.init();
</script>
{% endblock %}
